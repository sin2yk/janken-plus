<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>satellite521 v1（5-2-1点：双六/綱引き）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- 最小CSS：後でシンジ版CSSに全置換予定 -->
  <style>
    :root { 
      --gap: 10px; 
      --track:#e5e7eb; 
      --fillU:#3b82f6; 
      --fillA:#ef4444; 
      --uBase:#22c55e;  /* あなた陣地（緑） */
      --aBase:#ef4444;  /* AI陣地（赤）    */
      --muted:#ffffff; 
      --muted2:#000000;
    }

  body {
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
        line-height: 1.6;
        margin: 16px;

       /* 背景まわり */
        background-color: #000;                       /* 余白のベース色 */
        background-image: url("./images/space.jpg");  /* パスはそのままでOKならこのまま */
        background-repeat: no-repeat;                 /* 繰り返さない */
        background-size: contain;                     /* 画像全体が入るように縮小 */
        background-position: top center;              /* 画面上部に配置 */
        /* background-attachment: fixed;  は一旦ナシにしてOK（スクロールで一緒に動かす） */
            }

    
    h1 { color: #fff; }
    .muted { color: var(--muted); font-size: .9em}
    
    .panel {
        border: 1px solid rgba(255, 255, 255, 0.6);
        padding: 10px;
        margin: 12px 0;
        background: rgba(255, 255, 255, 0.92); /* ほぼ白カード */
        color: #111;                            /* 文字は濃いめの灰色に */
      }

    .row { display: flex; align-items: center; gap: var(--gap); margin: 8px 0; flex-wrap: wrap; }
    .grow { flex: 1 1 auto; }
    .mono { font-family: ui-monospace, Menlo, Monaco, Consolas, monospace; }
    .btns button { margin-right: 8px; }

    /* 双六のバー（あなた/AI） */
    .bar { position: relative; height: 14px; background: var(--track); border-radius: 8px; overflow: hidden; }
    .bar .fill { position: absolute; left: 0; top: 0; bottom: 0; width: 0%; }
    .bar .u { background: var(--fillU); }
    .bar .a { background: var(--fillA); }

    /* スコア行のラベル列（あなた / AI）の幅をそろえる */
    .row > strong {
      display: inline-block;
      width: 3em;          /* label幅：好みに応じて調整可 */
      text-align: right;   /* 右寄せでビシッと揃える */
    }

    /* 綱引きの差分バー（中央0、左右±10） */
    .tug {
      position: relative;
      height: 16px;
      border-radius: 999px;
      overflow: hidden;
      /* 左半分=あなた陣地(緑)、右半分=AI陣地(赤) のベース */
      background: linear-gradient(
        to right,
        var(--uBase) 0 50%,
        var(--aBase) 50% 100%
      );
    }

    /* 中央の0ライン */
    .tug .center {
      position:absolute;
      left:50%;
      top:0;
      bottom:0;
      width:2px;
      background:#fff;
      transform:translateX(-1px);
    }

    /* diff を上塗りするレイヤー（左右どちらか片方だけ使う） */
    .tug .left,
    .tug .right {
      position:absolute;
      top:0;
      bottom:0;
      width:0;
        /* opacity:1 がデフォなので、行ごと消してもOK */
      opacity: 1;
    }

    /* AIが押しているとき：左側（あなた陣地）をAI色で上塗り */
    .tug .left  {
      right:50%;             /* 中央から左方向へ */
      background: var(--aBase);
    }

    /* あなたが押しているとき：右側（AI陣地）をあなた色で上塗り */
    .tug .right {
      left:50%;              /* 中央から右方向へ */
      background: var(--uBase);
    }

        /* 綱引きビュー専用：バー→説明を縦に並べる */
    .row-tug {
      flex-direction: column;   /* 横並び→縦並び */
      align-items: stretch;     /* バーをフル幅に */
      gap: 4px;                 /* バーと説明のすきま */
    }

    .row-tug .tug {
      width: 100%;              /* 念のためバーを横いっぱいに */
    }

    .row-tug .mono {
      align-self: flex-start;   /* 説明文は左寄せのまま */
    }

    /* あなたの手：ボタンの並び */
    .btns {
      display: flex;
      gap: 12px;
    }

    /* 画像ボタンの見た目 */
    .hand-btn {
      border: none;
      padding: 0;
      background: transparent;
      cursor: pointer;
    }

    /* 画像のサイズ（必要に応じて調整） */
    .hand-icon {
      width: 80px;
      height: 80px;
      display: block;
    }

    /* AI手の分布スライダーのラベル列（R/S/P）の幅をそろえる */
    .row > label.mono {
      display: inline-block;
      width: 6em;          /* "R(グー)" などの列幅 */
    }

    /* rangeスライダーの基本スタイル（必要なら） */
    input[type="range"].grow {
      flex: 1 1 auto;  /* 残りスペースを気持ちよく埋める */
      min-width: 0;    /* はみ出し防止（flex子あるあるのおまじない） */
    }

      /* ===========================
       range スライダー自前デザイン
       =========================== */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      /* width は指定しない → .grow の flex で決める */
      height: 4px;
      border-radius: 999px;
      background: var(--track); /* 共通トラック色 */
      outline: none;
    }


    /* WebKit系（Chrome / Edge）用のつまみ */
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: var(--thumb, #666);  /* デフォルト色 or 下で上書き */
      border: 0;
      cursor: pointer;
    }

    /* Firefox 用のトラック＆つまみ */
    input[type="range"]::-moz-range-track {
      height: 4px;
      border-radius: 999px;
      background: var(--track);
    }
    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: var(--thumb, #666);
      border: 0;
      cursor: pointer;
    }

    /* R/S/P でつまみの色だけ切り替え */
    #probR { --thumb: #3b82f6; } /* 青：R(グー) */
    #probS { --thumb: #ef4444; } /* 赤：S(チョキ) */
    #probP { --thumb: #facc15; } /* 黄：P(パー) */
  

    pre { white-space: pre-wrap; max-height: 240px; overflow: auto; background: #fafafa; padding: 8px; border: 1px dashed #ddd; }
    fieldset { border: 1px solid #ddd; padding: 8px; }
    legend { padding: 0 6px; font-size: .95em; color:#444; }
    label input { vertical-align: middle; }
    .hidden { display: none; }
    
  </style>
</head>
<body>
  <h1>satellite521 v1.1</h1>
  <p class="muted">5-2-1点制。<b>モード</b>：<i>双六=30点先取</i>／<i>綱引き=10点差</i>。AI戦略は<b>手動/1⁄3/ナッシュ均衡</b>から選択。</p>

  <!-- 1) スコアと進行 -->
  <section class="panel">
    <h2>スコアと進行</h2>

    <div class="row">
      <fieldset>
        <legend>モード</legend>
        <label><input type="radio" name="mode" value="sugoroku" checked /> 双六（30点）</label>
        <label style="margin-left:10px;"><input type="radio" name="mode" value="tug" /> 綱引き（10点差）</label>
      </fieldset>
      <button id="btnReset" type="button">リセット</button>
      <span class="mono" style="margin-left:8px;">直近結果: <span id="resultLine">—</span></span>
    </div>

    <!-- 双六ビュー -->
    <div id="viewSugoroku">
      <div class="row"><strong>あなた</strong><div class="bar grow"><div id="uFill" class="fill u"></div></div><span class="mono" id="uScore">0</span>/<span class="mono">30</span></div>
      <div class="row"><strong>A I</strong><div class="bar grow"><div id="aFill" class="fill a"></div></div><span class="mono" id="aScore">0</span>/<span class="mono">30</span></div>
    </div>

    <!-- 綱引きビュー -->
    <div id="viewTug" class="hidden">
      <div class="row row-tug">
        <div class="tug grow">
          <div class="center"></div>
          <div id="leftFill"  class="left"></div>
          <div id="rightFill" class="right"></div>
        </div>
        <span class="mono">差(diff)=<span id="diffVal">0</span>（あなた−AI）／ 勝利条件: |diff| ≥ 10</span>
      </div>
      <div class="row">
        <span>あなた: <span class="mono" id="uScoreT">0</span> 点</span>
        <span style="margin-left:12px;">AI: <span class="mono" id="aScoreT">0</span> 点</span>
      </div>
    </div>
  </section>

  <!-- 2) あなたの手 -->
  <section class="panel">
    <h2>あなたの手</h2>
    <div class="btns">
      <button id="btnR" type="button" class="hand-btn"><img src="./images/gsy1.jpg" alt="グー" class="hand-icon" /></button>
      <button id="btnS" type="button" class="hand-btn"><img src="./images/csy1.png" alt="チョキ" class="hand-icon" /></button>
      <button id="btnP" type="button" class="hand-btn"><img src="./images/psy1.png" alt="パー" class="hand-icon" /></button>
    </div>
  </section>

  <!-- 3) ログ -->
  <section class="panel">
    <h2>ログ（最新→古い）</h2>
    <pre id="logBox" class="mono">—</pre>
  </section>

  <!-- 4) AI手の分布 操作盤 -->
  <section class="panel">
    <h2>AI手の分布 操作盤</h2>
    <div class="row">
      <fieldset>
        <legend>AI戦略</legend>
        <label><input type="radio" name="strategy" value="manual" checked /> 手動（スライダ）</label>
        <label style="margin-left:10px;"><input type="radio" name="strategy" value="uniform" /> ランダム（1/3）</label>
        <label style="margin-left:10px;"><input type="radio" name="strategy" value="nash" /> ナッシュ均衡（R=2/17, S=10/17, P=5/17）</label>
      </fieldset>
    </div>
    <div class="row">
      <label class="mono">R(グー)</label>
      <input id="probR" type="range" min="0" max="100" step="1" value="33" class="grow" />
      <span class="mono" id="probRVal">0.33</span>
    </div>
    <div class="row">
      <label class="mono">S(チョキ)</label>
      <input id="probS" type="range" min="0" max="100" step="1" value="33" class="grow" />
      <span class="mono" id="probSVal">0.33</span>
    </div>
    <div class="row">
      <label class="mono">P(パー)</label>
      <input id="probP" type="range" min="0" max="100" step="1" value="34" class="grow" />
      <span class="mono" id="probPVal">0.34</span>
    </div>
    <div class="muted2">※「手動」以外を選ぶとスライダは無効化され、値は自動表示になります。</div>
  </section>

  <script src="./js/satellite521.js"></script>
</body>
</html>
